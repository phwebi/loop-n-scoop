pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
circ_orig = 63
circ_r = 59

p_sprite_start=16
p_sprite_end=20
anim_wait=2
angular_speed = .005

local moving, aiming, leaping = 0, 1, 2

p = {}
p.x = 0
p.y = 0
p.state = moving
p.sprite = p_sprite_start
p.timer = 0
p.flip = false
p.ccw = false

function _init()
  -- draw black pixels
  palt(0, false)
 
  -- don't draw red pixels
  palt(8, true)

  p.x, p.y = ang_to_pl_coord(0)
end

function ang_to_pl_coord(angle)
  x=circ_orig + circ_r * cos(angle) - 3
  y=circ_orig + circ_r * sin(angle) - 3

  return x, y
end

function pl_coord_to_ang(x, y)
  return atan2(x - circ_orig + 3, y - circ_orig + 3)
end

function update_player_angle()
  updated = false
  angle = pl_coord_to_ang(p.x, p.y)

  if (btn(0)) then
    angle+=angular_speed
    if angle > 1 then angle = 0 end
    
    p.ccw = true
    updated = true
  elseif (btn(1)) then
    if angle == 0 then angle = 1 end
    angle-=angular_speed
    if angle < 0 then angle = 1 end

    p.ccw = false
    updated = true
  end

  if not updated then return end
  
  p.timer+=1

  if p.timer > anim_wait then
    p.sprite+=1
    p.timer = 0
  end

  if p.sprite > p_sprite_end then
    p.sprite = p_sprite_start
  end

  p.x, p.y = ang_to_pl_coord(angle)
  p.flip =
    (p.y > circ_orig and not p.ccw) or
    (p.y <= circ_orig and p.ccw)
end

function update_player_aiming()
  if btn(4) then p.state = aiming end
end

function _update()
  if (p.state == moving) then
    update_player_angle()
    update_player_aiming()
  end

  if (p.state == aiming) then
    -- press z to confirm
    -- press x to cancel
  end

  if (p.state == leaping) then
    -- update player location
  end
end

function _draw()
  map(0,0,0,0,16,16)
  circfill(circ_orig,circ_orig,55,12)

  spr(p.sprite,p.x,p.y,1,1,p.flip) 
end
__gfx__
00000000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000777677770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000777767770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888888888888888888888888888888888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88111188881111888811118888111188881111880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
81111118811111188111111881111118811111180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
81177718811777188117771881177718811777180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
81109018811090188110901881109018811090180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
81177718811779988117799889977718819977180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88998998889988888998888888888998888889980000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888888888888888888888888888888888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
